<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Calendar & Tasks</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .login-container h1 {
            margin-bottom: 30px;
            color: #333;
            text-align: center;
        }

        .login-container input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .login-container button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }

        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .main-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
        }

        .calendar-container,
        .tasks-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tasks-header {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid white;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .controls {
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .month-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .month-nav button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .month-nav h2 {
            min-width: 200px;
            text-align: center;
            color: #333;
        }

        .add-event-btn {
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            padding: 20px;
            gap: 10px;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            color: #667eea;
        }

        .day-cell {
            min-height: 100px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            background: white;
        }

        .day-cell.other-month {
            opacity: 0.3;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .event-item {
            font-size: 11px;
            padding: 3px 6px;
            margin: 2px 0;
            border-radius: 3px;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .event-item.repeating::after {
            content: 'üîÅ';
            font-size: 10px;
            margin-left: auto;
        }

        .tasks-content {
            padding: 20px 30px;
            max-height: 500px;
            overflow-y: auto;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .task-icon {
            font-size: 20px;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
            color: #333;
        }

        .task-title.completed {
            text-decoration: line-through;
            color: #999;
        }

        .task-category {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .task-actions button {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .repeat-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .repeat-option {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
        }

        .repeat-option.selected {
            border-color: #667eea;
            background: #e8eaf6;
        }

        .icon-selector {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .icon-option {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-size: 20px;
        }

        .icon-option.selected {
            border-color: #667eea;
            background: #e8eaf6;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .button-group button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .save-btn {
            background: #27ae60;
            color: white;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .cancel-btn {
            background: #95a5a6;
            color: white;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .category-color {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .category-info {
            flex: 1;
        }

        .category-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .category-actions {
            display: flex;
            gap: 5px;
        }

        .edit-category,
        .remove-category {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-category {
            background: #3498db;
            color: white;
        }

        .remove-category {
            background: #e74c3c;
            color: white;
        }

        .add-category-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .add-category-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .color-swatch {
            width: 100%;
            padding-top: 100%;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .color-swatch.selected {
            border-color: #333;
            transform: scale(1.1);
        }
    </style>
</head>

<body>

    <div class="login-container" id="loginContainer">
        <h1>üîí Calendar Login</h1>
        <div id="errorMessage" class="error-message"></div>
        <input type="password" id="passwordInput" placeholder="Enter your password"
            onkeyup="if(event.key==='Enter')login()" />
        <button onclick="login()">Login</button>
        <p style="margin-top: 20px; font-size: 12px; color: #999; text-align: center;">First time? Set your password</p>
    </div>

    <div class="main-container" id="mainContainer">
        <div class="calendar-container">
            <div class="header">
                <h1>üìÖ My Calendar</h1>
                <div class="header-buttons">
                    <button class="header-btn" onclick="openCategoriesModal('event')">‚öôÔ∏è Categories</button>
                    <button class="header-btn" onclick="logout()">Logout</button>
                </div>
            </div>
            <div class="controls">
                <div class="month-nav">
                    <button onclick="previousMonth()">‚Üê Previous</button>
                    <h2 id="currentMonth"></h2>
                    <button onclick="nextMonth()">Next ‚Üí</button>
                </div>
                <button class="add-event-btn" onclick="openEventModal()">+ Add Event</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <div class="tasks-container">
            <div class="tasks-header">
                <h1>‚úÖ My Tasks</h1>
                <div class="header-buttons">
                    <button class="header-btn" onclick="openCategoriesModal('task')">‚öôÔ∏è Categories</button>
                    <button class="add-event-btn" onclick="openTaskModal()">+ Add Task</button>
                </div>
            </div>
            <div class="tasks-content" id="tasksContent"></div>
        </div>
    </div>

    <div class="modal" id="eventModal">
        <div class="modal-content">
            <h2 id="modalTitle">Add Event</h2>
            <div class="form-group"><label>Title</label><input type="text" id="eventTitle" /></div>
            <div class="form-group"><label>Date</label><input type="date" id="eventDate" /></div>
            <div class="form-group"><label>Time</label><input type="time" id="eventTime" /></div>
            <div class="form-group"><label>Description</label><textarea id="eventDescription"></textarea></div>
            <div class="form-group"><label>Category</label><select id="eventCategory"></select></div>
            <div class="form-group"><label>Icon</label>
                <div class="icon-selector" id="iconSelector"></div>
            </div>
            <div class="form-group"><label>Repeat</label>
                <div class="repeat-options" id="repeatOptions"></div>
            </div>
            <div class="button-group">
                <button class="save-btn" onclick="saveEvent()">Save</button>
                <button class="delete-btn" id="deleteEventBtn" onclick="deleteEvent()"
                    style="display:none;">Delete</button>
                <button class="cancel-btn" onclick="closeEventModal()">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h2 id="taskModalTitle">Add Task</h2>
            <div class="form-group"><label>Title</label><input type="text" id="taskTitle" /></div>
            <div class="form-group"><label>Description</label><textarea id="taskDescription"></textarea></div>
            <div class="form-group"><label>Category</label><select id="taskCategory"></select></div>
            <div class="form-group"><label>Icon</label>
                <div class="icon-selector" id="taskIconSelector"></div>
            </div>
            <div class="form-group"><label>Repeat</label>
                <div class="repeat-options" id="taskRepeatOptions"></div>
            </div>
            <div class="button-group">
                <button class="save-btn" onclick="saveTask()">Save</button>
                <button class="delete-btn" id="deleteTaskBtn" onclick="deleteTask()"
                    style="display:none;">Delete</button>
                <button class="cancel-btn" onclick="closeTaskModal()">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="categoriesModal">
        <div class="modal-content">
            <h2 id="categoriesModalTitle">Manage Categories</h2>
            <div id="categoriesList"></div>
            <div class="add-category-section">
                <h3>Add New Category</h3>
                <div class="form-group"><label>Name</label><input type="text" id="newCategoryName" /></div>
                <div class="form-group"><label>Icon</label>
                    <div class="icon-selector" id="categoryIconSelector"></div>
                </div>
                <div class="form-group"><label>Color</label>
                    <div class="color-grid" id="colorGrid"></div>
                </div>
                <button class="save-btn" onclick="addCategory()" style="width:100%">Add</button>
            </div>
            <div class="button-group"><button class="cancel-btn" onclick="closeCategoriesModal()">Close</button></div>
        </div>
    </div>

    <div class="modal" id="editCategoryModal">
        <div class="modal-content">
            <h2>Edit Category</h2>
            <div class="form-group"><label>Name</label><input type="text" id="editCategoryName" /></div>
            <div class="form-group"><label>Icon</label>
                <div class="icon-selector" id="editCategoryIconSelector"></div>
            </div>
            <div class="form-group"><label>Color</label>
                <div class="color-grid" id="editColorGrid"></div>
            </div>
            <div class="button-group">
                <button class="save-btn" onclick="saveEditedCategory()">Save</button>
                <button class="cancel-btn" onclick="closeEditCategoryModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date(), events = {}, repeatingEvents = [], tasks = [], repeatingTasks = [], eventCategories = {}, taskCategories = {}, editingEventId = null, editingTaskId = null, editingCategoryKey = null, currentCategoryType = 'event', selectedEventIcon = '', selectedTaskIcon = '', selectedCategoryIcon = '', selectedColor = '', selectedEditColor = '', selectedEditIcon = '', selectedRepeat = 'none', selectedTaskRepeat = 'none';
        const ICONS = ['üéâ', 'üéÇ', 'üíº', 'üìÖ', '‚úàÔ∏è', 'üè•', 'üéì', 'üí™', 'üçΩÔ∏è', 'üéµ', 'üìö', 'üíª', 'üé®', '‚öΩ', 'üèÄ', 'ü§∏', 'üéÆ', 'üé¨', 'üìû', '‚úâÔ∏è', 'üè†', 'üöó', 'üéÅ', '‚ù§Ô∏è', '‚≠ê', 'üîî', 'üìù', 'üí°', 'üîß', 'üõí', '‚òï', 'üåü', 'üéØ', 'üìä', 'üßπ', 'üß∫', 'üßº', 'üßΩ', 'üß¥', 'üõÅ', 'üßª', 'üóëÔ∏è', 'üî®', 'ü™õ', 'ü™ö'];
        const COLORS = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e91e63', '#795548', '#ff5722', '#00bcd4', '#4caf50', '#ffc107', '#673ab7', '#009688', '#ff4081', '#8d6e63', '#f44336', '#2196f3', '#8bc34a', '#ffeb3b', '#9c27b0', '#00acc1', '#ec407a', '#a1887f'];
        const REPEAT = [{ value: 'none', label: 'No Repeat' }, { value: 'daily', label: 'Every Day' }, { value: 'weekly', label: 'Every Week' }, { value: 'biweekly', label: 'Every 2 Weeks' }, { value: 'monthly', label: 'Every Month' }, { value: 'yearly', label: 'Every Year' }];

        function hash(p) { let h = 0; for (let i = 0; i < p.length; i++) { h = ((h << 5) - h) + p.charCodeAt(i); h &= h; } return h.toString(); }
        function formatTime(t) { if (!t) return ''; let [h, m] = t.split(':'); h = parseInt(h); const ampm = h >= 12 ? 'PM' : 'AM'; h = h % 12; h = h ? h : 12; return `${h}:${m} ${ampm}`; }
        function login() { const p = document.getElementById('passwordInput').value, e = document.getElementById('errorMessage'); if (!p) { e.textContent = 'Enter password'; return; } const h = hash(p), s = localStorage.getItem('cal_pw'); if (!s) { localStorage.setItem('cal_pw', h); init(); } else if (s === h) { init(); } else { e.textContent = 'Wrong password'; } }
        function logout() { document.getElementById('loginContainer').style.display = 'block'; document.getElementById('mainContainer').style.display = 'none'; document.getElementById('passwordInput').value = ''; }
        function init() { document.getElementById('loginContainer').style.display = 'none'; document.getElementById('mainContainer').style.display = 'block'; load(); renderCalendar(); renderTasks(); }
        function load() { events = JSON.parse(localStorage.getItem('events') || '{}'); repeatingEvents = JSON.parse(localStorage.getItem('repEvents') || '[]'); tasks = JSON.parse(localStorage.getItem('tasks') || '[]'); repeatingTasks = JSON.parse(localStorage.getItem('repTasks') || '[]'); eventCategories = JSON.parse(localStorage.getItem('eCats') || '{"personal":{"name":"Personal","color":"#3498db","icon":"üë§"},"work":{"name":"Work","color":"#e74c3c","icon":"üíº"}}'); taskCategories = JSON.parse(localStorage.getItem('tCats') || '{"cleaning":{"name":"Cleaning","color":"#3498db","icon":"üßπ"},"shopping":{"name":"Shopping","color":"#f39c12","icon":"üõí"}}'); updateSelects(); }
        function save() { localStorage.setItem('events', JSON.stringify(events)); localStorage.setItem('repEvents', JSON.stringify(repeatingEvents)); localStorage.setItem('tasks', JSON.stringify(tasks)); localStorage.setItem('repTasks', JSON.stringify(repeatingTasks)); localStorage.setItem('eCats', JSON.stringify(eventCategories)); localStorage.setItem('tCats', JSON.stringify(taskCategories)); }

        function getRepEvents(dk) { const d = new Date(dk), arr = []; repeatingEvents.forEach(e => { const ed = new Date(e.startDate); if (d < ed) return; let show = false; switch (e.repeat) { case 'daily': show = true; break; case 'weekly': show = d.getDay() === ed.getDay(); break; case 'biweekly': const diff = Math.floor((d - ed) / (864e5)); show = d.getDay() === ed.getDay() && diff % 14 === 0; break; case 'monthly': show = d.getDate() === ed.getDate(); break; case 'yearly': show = d.getDate() === ed.getDate() && d.getMonth() === ed.getMonth(); break; }if (show) arr.push({ ...e, isRepeating: true }); }); return arr; }

        function getRepTasks() { const t = new Date(), tk = `${t.getFullYear()}-${String(t.getMonth() + 1).padStart(2, '0')}-${String(t.getDate()).padStart(2, '0')}`, arr = []; repeatingTasks.forEach(task => { if (!task.startDate) return; const td = new Date(task.startDate), today = new Date(tk); if (today < td) return; let show = false; switch (task.repeat) { case 'daily': show = true; break; case 'weekly': show = today.getDay() === td.getDay(); break; case 'biweekly': const diff = Math.floor((today - td) / (864e5)); show = today.getDay() === td.getDay() && diff % 14 === 0; break; case 'monthly': show = today.getDate() === td.getDate(); break; case 'yearly': show = today.getDate() === td.getDate() && today.getMonth() === td.getMonth(); break; }if (show) { const done = task.completedDates && task.completedDates.includes(tk); arr.push({ ...task, isRepeating: true, completed: done, currentDate: tk }); } }); return arr; }

        function renderCalendar() { const y = currentDate.getFullYear(), m = currentDate.getMonth(); document.getElementById('currentMonth').textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' }); const first = new Date(y, m, 1), last = new Date(y, m + 1, 0), prev = new Date(y, m, 0), start = first.getDay(), total = last.getDate(), grid = document.getElementById('calendarGrid'); grid.innerHTML = '';['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(d => { const h = document.createElement('div'); h.className = 'day-header'; h.textContent = d; grid.appendChild(h); }); for (let i = start - 1; i >= 0; i--) { grid.appendChild(createDay(prev.getDate() - i, y, m - 1, true)); } for (let d = 1; d <= total; d++) { grid.appendChild(createDay(d, y, m, false)); } const rem = 42 - (start + total); for (let d = 1; d <= rem; d++) { grid.appendChild(createDay(d, y, m + 1, true)); } }

        function createDay(day, y, m, other) { const cell = document.createElement('div'); cell.className = 'day-cell' + (other ? ' other-month' : ''); const num = document.createElement('div'); num.className = 'day-number'; num.textContent = day; cell.appendChild(num); const dk = `${y}-${String(m + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; const all = [...(events[dk] || []), ...getRepEvents(dk)]; all.forEach(e => { const el = document.createElement('div'); el.className = 'event-item' + (e.isRepeating ? ' repeating' : ''); el.style.backgroundColor = eventCategories[e.category]?.color || '#999'; const ic = e.icon || eventCategories[e.category]?.icon || ''; if (ic) { const sp = document.createElement('span'); sp.textContent = ic; el.appendChild(sp); } const txt = document.createElement('span'); txt.textContent = e.time ? `${formatTime(e.time)} ${e.title}` : e.title; el.appendChild(txt); el.onclick = ev => { ev.stopPropagation(); openEventModal(e.id, dk, e.isRepeating); }; cell.appendChild(el); }); if (!other) cell.onclick = () => openEventModal(null, dk); return cell; }

        function previousMonth() { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); }
        function nextMonth() { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); }

        function renderRep(id) { const c = document.getElementById(id); c.innerHTML = ''; REPEAT.forEach(r => { const o = document.createElement('div'); o.className = 'repeat-option'; if (r.value === (id.includes('task') ? selectedTaskRepeat : selectedRepeat)) o.classList.add('selected'); o.textContent = r.label; o.onclick = () => { c.querySelectorAll('.repeat-option').forEach(e => e.classList.remove('selected')); o.classList.add('selected'); if (id.includes('task')) selectedTaskRepeat = r.value; else selectedRepeat = r.value; }; c.appendChild(o); }); }

        function renderIcons(id, sel, cb) { const c = document.getElementById(id); c.innerHTML = ''; ICONS.forEach(ic => { const o = document.createElement('div'); o.className = 'icon-option'; if (ic === sel) o.classList.add('selected'); o.textContent = ic; o.onclick = () => { c.querySelectorAll('.icon-option').forEach(e => e.classList.remove('selected')); o.classList.add('selected'); cb(ic); }; c.appendChild(o); }); }

        function renderColors(id, sel, cb) { const c = document.getElementById(id); c.innerHTML = ''; COLORS.forEach(col => { const s = document.createElement('div'); s.className = 'color-swatch'; if (col === sel) s.classList.add('selected'); s.style.backgroundColor = col; s.onclick = () => { c.querySelectorAll('.color-swatch').forEach(e => e.classList.remove('selected')); s.classList.add('selected'); cb(col); }; c.appendChild(s); }); }

        function openEventModal(id = null, dk = null, rep = false) { editingEventId = id; const m = document.getElementById('eventModal'), db = document.getElementById('deleteEventBtn'); if (id) { document.getElementById('modalTitle').textContent = 'Edit Event'; db.style.display = 'block'; let ev = null; if (rep) ev = repeatingEvents.find(e => e.id === id); else { for (let d in events) { ev = events[d].find(e => e.id === id); if (ev) { dk = d; break; } } } if (ev) { document.getElementById('eventTitle').value = ev.title; document.getElementById('eventDate').value = rep ? ev.startDate : dk; document.getElementById('eventTime').value = ev.time || ''; document.getElementById('eventDescription').value = ev.description || ''; document.getElementById('eventCategory').value = ev.category; selectedEventIcon = ev.icon || ''; selectedRepeat = ev.repeat || 'none'; } } else { document.getElementById('modalTitle').textContent = 'Add Event'; db.style.display = 'none'; document.getElementById('eventTitle').value = ''; document.getElementById('eventDate').value = dk || ''; document.getElementById('eventTime').value = ''; document.getElementById('eventDescription').value = ''; document.getElementById('eventCategory').value = Object.keys(eventCategories)[0]; selectedEventIcon = ''; selectedRepeat = 'none'; } renderIcons('iconSelector', selectedEventIcon, ic => selectedEventIcon = ic); renderRep('repeatOptions'); m.style.display = 'flex'; }

        function closeEventModal() { document.getElementById('eventModal').style.display = 'none'; editingEventId = null; selectedEventIcon = ''; selectedRepeat = 'none'; }

        function saveEvent() { const t = document.getElementById('eventTitle').value.trim(), d = document.getElementById('eventDate').value, tm = document.getElementById('eventTime').value, desc = document.getElementById('eventDescription').value.trim(), cat = document.getElementById('eventCategory').value; if (!t || !d) { alert('Enter title and date'); return; } if (editingEventId) { for (let dk in events) { const i = events[dk].findIndex(e => e.id === editingEventId); if (i !== -1) { events[dk].splice(i, 1); if (!events[dk].length) delete events[dk]; break; } } const ri = repeatingEvents.findIndex(e => e.id === editingEventId); if (ri !== -1) repeatingEvents.splice(ri, 1); } const ev = { id: editingEventId || Date.now().toString(), title: t, time: tm, description: desc, category: cat, icon: selectedEventIcon, repeat: selectedRepeat }; if (selectedRepeat === 'none') { if (!events[d]) events[d] = []; events[d].push(ev); } else { ev.startDate = d; repeatingEvents.push(ev); } save(); renderCalendar(); closeEventModal(); }

        function deleteEvent() { if (!confirm('Delete event?')) return; for (let dk in events) { const i = events[dk].findIndex(e => e.id === editingEventId); if (i !== -1) { events[dk].splice(i, 1); if (!events[dk].length) delete events[dk]; break; } } const ri = repeatingEvents.findIndex(e => e.id === editingEventId); if (ri !== -1) repeatingEvents.splice(ri, 1); save(); renderCalendar(); closeEventModal(); }

        function renderTasks() { const c = document.getElementById('tasksContent'); c.innerHTML = ''; const all = [...tasks, ...getRepTasks()]; if (!all.length) { c.innerHTML = '<p style="text-align:center;color:#999;padding:40px">No tasks</p>'; return; } const act = all.filter(t => !t.completed), done = all.filter(t => t.completed);[...act, ...done].forEach(t => { const el = document.createElement('div'); el.className = 'task-item'; const cb = document.createElement('input'); cb.type = 'checkbox'; cb.className = 'task-checkbox'; cb.checked = t.completed; cb.onchange = () => toggleTask(t.id, t.isRepeating, t.currentDate); const ic = document.createElement('span'); ic.className = 'task-icon'; ic.textContent = t.icon || taskCategories[t.category]?.icon || 'üìù'; const det = document.createElement('div'); det.className = 'task-details'; const tit = document.createElement('div'); tit.className = 'task-title' + (t.completed ? ' completed' : ''); tit.textContent = t.title + (t.isRepeating ? ' üîÅ' : ''); const cat = document.createElement('div'); cat.className = 'task-category'; cat.textContent = taskCategories[t.category]?.name || 'Other'; cat.style.color = taskCategories[t.category]?.color || '#999'; det.appendChild(tit); det.appendChild(cat); const acts = document.createElement('div'); acts.className = 'task-actions'; const eb = document.createElement('button'); eb.textContent = 'Edit'; eb.style.background = '#3498db'; eb.style.color = 'white'; eb.onclick = () => openTaskModal(t.id, t.isRepeating); const db = document.createElement('button'); db.textContent = 'Delete'; db.style.background = '#e74c3c'; db.style.color = 'white'; db.onclick = () => deleteTask(t.id, t.isRepeating); acts.appendChild(eb); acts.appendChild(db); el.appendChild(cb); el.appendChild(ic); el.appendChild(det); el.appendChild(acts); c.appendChild(el); }); }

        function openTaskModal(id = null, rep = false) { editingTaskId = id; const m = document.getElementById('taskModal'), db = document.getElementById('deleteTaskBtn'); if (id) { document.getElementById('taskModalTitle').textContent = 'Edit Task'; db.style.display = 'block'; let t = null; if (rep) t = repeatingTasks.find(tk => tk.id === id); else t = tasks.find(tk => tk.id === id); if (t) { document.getElementById('taskTitle').value = t.title; document.getElementById('taskDescription').value = t.description || ''; document.getElementById('taskCategory').value = t.category; selectedTaskIcon = t.icon || ''; selectedTaskRepeat = t.repeat || 'none'; } } else { document.getElementById('taskModalTitle').textContent = 'Add Task'; db.style.display = 'none'; document.getElementById('taskTitle').value = ''; document.getElementById('taskDescription').value = ''; document.getElementById('taskCategory').value = Object.keys(taskCategories)[0]; selectedTaskIcon = ''; selectedTaskRepeat = 'none'; } renderIcons('taskIconSelector', selectedTaskIcon, ic => selectedTaskIcon = ic); renderRep('taskRepeatOptions'); m.style.display = 'flex'; }

        function closeTaskModal() { document.getElementById('taskModal').style.display = 'none'; editingTaskId = null; selectedTaskIcon = ''; selectedTaskRepeat = 'none'; }

        function saveTask() { const t = document.getElementById('taskTitle').value.trim(), desc = document.getElementById('taskDescription').value.trim(), cat = document.getElementById('taskCategory').value; if (!t) { alert('Enter title'); return; } if (editingTaskId) { const i = tasks.findIndex(tk => tk.id === editingTaskId); if (i !== -1) tasks.splice(i, 1); const ri = repeatingTasks.findIndex(tk => tk.id === editingTaskId); if (ri !== -1) repeatingTasks.splice(ri, 1); } const tk = { id: editingTaskId || Date.now().toString(), title: t, description: desc, category: cat, icon: selectedTaskIcon, repeat: selectedTaskRepeat, completed: false, startDate: new Date().toISOString().split('T')[0] }; if (selectedTaskRepeat === 'none') tasks.push(tk); else repeatingTasks.push(tk); save(); renderTasks(); closeTaskModal(); }

        function deleteTask() { if (!confirm('Delete task?')) return; const i = tasks.findIndex(tk => tk.id === editingTaskId); if (i !== -1) tasks.splice(i, 1); const ri = repeatingTasks.findIndex(tk => tk.id === editingTaskId); if (ri !== -1) repeatingTasks.splice(ri, 1); save(); renderTasks(); closeTaskModal(); }

        function toggleTask(id, rep, curDate) { if (rep) { const t = repeatingTasks.find(tk => tk.id === id); if (t) { if (!t.completedDates) t.completedDates = []; if (t.completedDates.includes(curDate)) t.completedDates = t.completedDates.filter(d => d !== curDate); else t.completedDates.push(curDate); } } else { const t = tasks.find(tk => tk.id === id); if (t) t.completed = !t.completed; } save(); renderTasks(); }

        function updateSelects() { const ec = document.getElementById('eventCategory'), tc = document.getElementById('taskCategory'); ec.innerHTML = ''; tc.innerHTML = ''; for (let k in eventCategories) { const op = document.createElement('option'); op.value = k; op.textContent = eventCategories[k].name; ec.appendChild(op); } for (let k in taskCategories) { const op = document.createElement('option'); op.value = k; op.textContent = taskCategories[k].name; tc.appendChild(op); } }

        function openCategoriesModal(type) { currentCategoryType = type; const m = document.getElementById('categoriesModal'); document.getElementById('categoriesModalTitle').textContent = type === 'event' ? 'Manage Event Categories' : 'Manage Task Categories'; renderCategoriesList(); renderIcons('categoryIconSelector', selectedCategoryIcon, ic => selectedCategoryIcon = ic); renderColors('colorGrid', selectedColor, c => selectedColor = c); m.style.display = 'flex'; }

        function closeCategoriesModal() { document.getElementById('categoriesModal').style.display = 'none'; }

        function renderCategoriesList() { const l = document.getElementById('categoriesList'); l.innerHTML = ''; const cats = currentCategoryType === 'event' ? eventCategories : taskCategories; for (let k in cats) { const c = cats[k]; const d = document.createElement('div'); d.className = 'category-item'; d.innerHTML = `<div class="category-color" style="background:${c.color}"></div><div class="category-info"><div class="category-name">${c.icon || ''} ${c.name}</div></div><div class="category-actions"><button class="remove-category" onclick="deleteCategory('${k}')">Remove</button></div>`; l.appendChild(d); } }

        function addCategory() { const n = document.getElementById('newCategoryName').value.trim(); if (!n || !selectedColor) { alert('Name and color required'); return; } const k = n.toLowerCase().replace(/\s+/g, '_'); const nc = { name: n, color: selectedColor, icon: selectedCategoryIcon || '' }; if (currentCategoryType === 'event') eventCategories[k] = nc; else taskCategories[k] = nc; document.getElementById('newCategoryName').value = ''; selectedColor = ''; selectedCategoryIcon = ''; renderIcons('categoryIconSelector', '', ic => selectedCategoryIcon = ic); renderColors('colorGrid', '', c => selectedColor = c); save(); renderCategoriesList(); updateSelects(); }

        function deleteCategory(k) { if (!confirm('Delete category?')) return; if (currentCategoryType === 'event') delete eventCategories[k]; else delete taskCategories[k]; save(); renderCategoriesList(); updateSelects(); }

        function closeEditCategoryModal() { document.getElementById('editCategoryModal').style.display = 'none'; }
        function saveEditedCategory() { closeEditCategoryModal(); }

    </script>
</body>

</html>